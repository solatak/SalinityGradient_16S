---
title: "Biodiversity Analysis"
author: "Sola Takahashi"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      fig.path = "../figures/04_Biodiversity")
```

# Setting the Environment

## Set the seed
```{r set-seed}
set.seed(158369)
```


## Load Libraries
```{r load-packages}
pacman::p_load(tidyverse, devtools, patchwork, iNEXT, phyloseq, 
               install = FALSE)
```


## Load in Data
```{r load-data}
load("data/02_PreProcessing/raw_preprocessed_physeq.RData")
raw_preprocessed_physeq

# Intuition Check
min(sample_sums(raw_preprocessed_physeq))
# output: 1836

# Setting colors for the stations
station_colors <- c(
  "Shipping Channel" = "dodgerblue4",
  "Aransas Bay" = "dodgerblue2",
  "Copano West" = "#D9CC3C",
  "Copano East" = "#A0E0BA",
  "Mesquite Bay" = "#00ADA7")


```


# Goals

1. Calculate the Hill Diversity of the samples
2. Evaluate the rarefaction curves
3. Evaluate the Diversity values
4. Make notes of specific samples and their seq depth 

# Diversity Calculations with iNEXT

```{r calc-div}
# prepare input data
iNEXT_input_df <-
  raw_preprocessed_physeq %>%
  otu_table() %>%
  data.frame()

# Quick check
dim(iNEXT_input_df)

# Run iNEXT: Calculate Hill Numbers
# Note that: Species in ROWS and samples in COLUMNS
# Remember to set the seed!
# iNEXT_data <- iNEXT(iNEXT_input_df, q = c(0,1,2), 
#                    datatype = "abundance")

# Save the file
#save(iNEXT_data, file = "data/04_Biodiversity/iNEXT_data.RData")
```

# Evaluate the Diversity
```{r load-div}
load("data/04_Biodiversity/iNEXT_data.RData")
str(iNEXT_data)
typeof(iNEXT_data)

```


```{r plot-rarefaction}
# Prepare colors
color_df <-
  iNEXT_input_df %>%
  colnames() %>%
  data.frame()
  
# Check
head(color_df)
# Rename column
colnames(color_df)[1] <- "names"

# END HERE

```





